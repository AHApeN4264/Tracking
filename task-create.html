{% extends 'base.html' %}
{% load static %}

{% block title %}
  <title>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è</title>
  <link rel="icon" type="image/x-icon" href="{% static 'icons/icons8-brutus-32.ico' %}">
  <link rel="stylesheet" href="{% static 'css/room-for-sell.css' %}">
{% endblock %}

{% block body %}

<div class="menu-button-wrapper">
  {% if user.username %}
    <div id="menu" class="styled-button" onclick="redirectToMenu()">
      üî• <span>–ú–µ–Ω—é</span> üî•
    </div>
  {% else %}
    <div id="menu" class="styled-button" onclick="redirectToMenuNone()">
      üî• <span>–ú–µ–Ω—é</span> üî•
    </div>
  {% endif %}
</div>

<div class="username-display">
  {% if user.username %}
    <a href="/settings" class="login-link">üë§ {{ user.username }}</a>
    <a href="/wallet" class="login-link">({{ user.wallet }})</a>
  {% else %}
    üë§ –í–∏ –Ω–µ —É–≤—ñ–π—à–ª–∏ –≤ –∞–∫–∞—É–Ω—Ç<br>
    <a href="/login" class="login-link">–£–≤—ñ–π—Ç–∏</a>
  {% endif %}
  <div class="switch-wrapper">
    <label class="switch" title="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É">
      <input type="checkbox" id="themeToggle" aria-label="Theme toggle">
      <span class="slider"></span>
    </label>
  </div>
</div>

<div class="background rooms-wiew">
  <div class="container">
    <form method="post" action="/task-create/{{ user.id }}" enctype="multipart/form-data" class="form">
      {% csrf_token %}
      <h1>–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è</h1>

      {% if messages %}
        {% for message in messages %}
          <p class="{% if 'success' in message.tags %}message{% elif 'error' in message.tags %}error-msg{% else %}info-msg{% endif %}">
            {{ message }}
          </p>
        {% endfor %}
      {% endif %}

      <label>–ù–∞–∑–≤–∞:
        <input type="text" name="title" required>
      </label>

      <label>–û–ø–∏—Å–∞–Ω–Ω—è:
        <textarea name="description" rows="4" cols="40" required style="resize: vertical;"></textarea>
      </label>

      <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
        <select name="priority" required>
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>
      </label>

      <label>–¢–µ—Ä–º—ñ–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:
        <input type="datetime-local" name="deadline" id="end_date"
          value="{{ now_str }}"
          min="{{ now_str }}"
          required>
      </label>

      <label>–ó–∞–≤–¥–∞–Ω–Ω—è:
        <textarea name="tasks" rows="4" cols="40" required style="resize: vertical;"></textarea>
      </label>

      <label>–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:
        <textarea name="correct_answer" rows="4" cols="40" required style="resize: vertical;">{{ task.correct_answer }}</textarea>
      </label>

      <label>–ü—ñ–¥–ø–∏—Å–∫–∞:
        <select name="subscription" required>
          <option value="–ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞" {% if task.subscription == '–ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞' %}selected{% endif %}>–ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞</option>
          <option value="–ü–æ—Ç—Ä—ñ–±–Ω–∞" {% if task.subscription == '–ü–æ—Ç—Ä—ñ–±–Ω–∞' %}selected{% endif %}>–ü–æ—Ç—Ä—ñ–±–Ω–∞</option>
        </select>
      </label>

      <label>–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:
        <select name="activity_status" required>
          <option value="active" {% if task.status == 'active' %}selected{% endif %}>–ê–∫—Ç–∏–≤–Ω–æ</option>
          <option value="inactive" {% if task.status == 'inactive' %}selected{% endif %}>–ù–µ–∞–∫—Ç–∏–≤–Ω–æ</option>
        </select>
      </label>

      <label>–°—Ç–∞—Ç—É—Å –∑–∞–≤–¥–∞–Ω–Ω—è:
        <select name="task_status" required>
          <option value="active" {% if task.status == 'active' %}selected{% endif %}>–í—ñ–¥–∫—Ä–∏—Ç–æ</option>
          <option value="inactive" {% if task.status == 'inactive' %}selected{% endif %}>–ü—Ä–∏—Ö–æ–≤–∞—Ç–∏</option>
        </select>
      </label>
      <button type="submit" class="btn">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</button>
    </form>
  </div>
</div>

<script>
  const startDateInput = document.getElementById('start_date');
  const endDateInput = document.getElementById('end_date');

  function getDayWord(days) {
    if (days === 1) return '–¥–µ–Ω—å';
    if (days >= 2 && days <= 4) return '–¥–Ω—ñ';
    return '–¥–Ω—ñ–≤';
  }
</script>

<style>
html, body {
  height: 100%;
  margin: 0;
  background: linear-gradient(135deg, #703400, #ACB6E5);
  color: #000;
  font-family: Arial, sans-serif;
  transition: background-color 0.3s, color 0.3s;
}
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.getElementById("themeToggle");
    const html = document.documentElement;

    if (localStorage.getItem("darkTheme") === "true") {
      html.classList.add("dark-theme");
      toggle.checked = true;
    }

    toggle.addEventListener("change", function () {
      html.classList.toggle("dark-theme", this.checked);
      localStorage.setItem("darkTheme", this.checked);
    });
  });

  function redirectToMenu() {
    window.location.href = "/menu/{{ user.id }}";
  }

  function redirectToMenuNone() {
    window.location.href = "/menu/none";
  }
</script>
{% endblock %}
